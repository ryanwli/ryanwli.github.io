<!DOCTYPE html>  
<html lang="en">  
<head>  
  <link rel="apple-touch-icon-precomposed" href="https://ryanwli.github.io/trip/2024/guilin/app_icon.png" /> 
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Document</title>  
</head>  
<body style="padding: 10px;">  
<br/>
<div>
    Now: <span id="timeSpan"></span><br>
    Abbr.:<br/>
    SK: <span>Self Keep</span> <br/>
    PK: <span>Parent Keep</span> <br/>
</div> 
<br/>
<br/>
<div id="myDiv">Subsistence Threshold(Regular): <span id="mySpan"></span></div> 
<div>
    Each Subsistence: <br/>
    RY: <span id="p1SpanM">0.55</span> <br/>
    RA: <span id="p2SpanM">0.35</span><br/>
    MK: <span id="p3SpanM">0.1</span><br/>
</div>

<br/>
<br/>
<div id="myDiv">Subsistence Threshold(Low): <span id="mySpanLow"></span></div> 
<div>
    Each Subsistence(Low): <br/>
    RY: <span id="p1SpanLowM">0.5</span> <br/>
    RA: <span id="p2SpanLowM">0.3</span><br/>
    MK: <span id="p3SpanLowM">0.1</span><br/>
</div>
  
<script>  

function monthsBetweenDates(startDate, endDate) {  
    function dateToMonths(date) {  
        let years = date.getFullYear() - 1900;  
        let months = years * 12 + date.getMonth() + 1;  
        return months;  
    }  
    const now = new Date();   
    const startMonths = dateToMonths(startDate || now); 
    const endMonths = dateToMonths(endDate);  
  
    return endMonths - startMonths;  
} 

function calcHighSchoolDeposit() {
    const p3BeginDate = new Date(2028, 8, 1);
    let p3BeginMonths = monthsBetweenDates(null, p3BeginDate);
    const p3EndDate = new Date(2031, 7, 31);
    let p3EndMonths = monthsBetweenDates(p3BeginDate, p3EndDate);
    let p3Deposit = 0;
    if (p3BeginMonths > 0) {
        p3Deposit = 0.15 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
        p3Deposit = p3Deposit / Math.pow(1 + 0.02/12, p3BeginMonths);
        
    } else if (p3EndMonths > 0) {
        p3Deposit = 0.15 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
    }
    return p3Deposit;
}

function calcUniversityDeposit() {
    const p3BeginDate = new Date(2031, 8, 1);
    let p3BeginMonths = monthsBetweenDates(null, p3BeginDate);
    const p3EndDate = new Date(2035, 7, 31);
    let p3EndMonths = monthsBetweenDates(p3BeginDate, p3EndDate);
    let p3Deposit = 0;
    if (p3BeginMonths > 0) {
        p3Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
        p3Deposit = p3Deposit / Math.pow(1 + 0.02/12, p3BeginMonths);
        
    } else if (p3EndMonths > 0) {
        p3Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
    }
    return p3Deposit;
}

document.addEventListener('DOMContentLoaded', function() {  

    var span = document.getElementById('mySpan');  
    var spanLow = document.getElementById('mySpanLow');
      
    const p1RetireDate = new Date(2046, 5, 14);
    let p1Months = monthsBetweenDates(null, p1RetireDate);
    let p1Deposit = 0;
    let p1DepositLow = 0;
    if (p1Months > 0) {
        p1Deposit = 0.55 / (0.02/12 * Math.pow(1 + 0.02/12, p1Months) / (Math.pow(1 + 0.02/12, p1Months) - 1));
        p1DepositLow = 0.5 / (0.02/12 * Math.pow(1 + 0.02/12, p1Months) / (Math.pow(1 + 0.02/12, p1Months) - 1));
    }

    const p2RetireDate = new Date(2036, 12, 14);
    let p2Months = monthsBetweenDates(null, p2RetireDate);
    let p2Deposit = 0;
    let p2DepositLow = 0;
    if (p2Months > 0) {
        p2Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p2Months) / (Math.pow(1 + 0.02/12, p2Months) - 1));
        p2DepositLow = 0.3 / (0.02/12 * Math.pow(1 + 0.02/12, p2Months) / (Math.pow(1 + 0.02/12, p2Months) - 1));
    }

    const p3PrimarySchoolFinishDate = new Date(2028, 7, 31);
    let p3PrimarySchoolFinishMonths = monthsBetweenDates(null, p3PrimarySchoolFinishDate);
    let p3Deposit = 0;
    if (p3PrimarySchoolFinishMonths > 0) {
        p3Deposit = 0.1 / (0.02/12 * Math.pow(1 + 0.02/12, p3PrimarySchoolFinishMonths) / (Math.pow(1 + 0.02/12, p3PrimarySchoolFinishMonths) - 1));
    }
    p3Deposit = p3Deposit + calcHighSchoolDeposit() + calcUniversityDeposit();
    var myString = (p1Deposit + p2Deposit + p3Deposit).toFixed(3);
    span.innerHTML = myString; 
    var myStringLow = (p1DepositLow + p2DepositLow + p3Deposit).toFixed(3);
    spanLow.innerHTML = myStringLow; 

    var p1SpanM = document.getElementById('p1SpanM');
    var p2SpanM = document.getElementById('p2SpanM');
    var p3SpanM = document.getElementById('p3SpanM');
    var p1SpanLowM = document.getElementById('p1SpanLowM');
    var p2SpanLowM = document.getElementById('p2SpanLowM');
    var p3SpanLowM = document.getElementById('p3SpanLowM');

    if (new Date() < p1RetireDate) {
        p1SpanM.innerHTML = "0.55(M),"+p1Deposit.toFixed(3)+"(T)";
        p1SpanLowM.innerHTML = "0.5(M),"+p1DepositLow.toFixed(3)+"(T)";
    } else {
        p1SpanM.innerHTML = "Retired";
        p1SpanLowM.innerHTML = "Retired";
    } 

    if (new Date() < p2RetireDate) {
        p2SpanM.innerHTML = "0.35(M),"+p2Deposit.toFixed(3)+"(T)";
        p2SpanLowM.innerHTML = "0.3(M),"+p2DepositLow.toFixed(3)+"(T)";
    } else {
        p2SpanM.innerHTML = "Retired";
        p2SpanLowM.innerHTML = "Retired";
    }


    if (new Date() < new Date(2028, 8, 1)) {
        p3SpanM.innerHTML = "0.1(M,PK),"+p3Deposit.toFixed(3)+"(T)";
        p3SpanLowM.innerHTML = "0.1(M,PK),"+p3Deposit.toFixed(3)+"(T)";
    } else if (new Date() < new Date(2031, 8, 1)) {
        p3SpanM.innerHTML = "0.15(M,PK),"+p3Deposit.toFixed(3)+"(T)";
        p3SpanLowM.innerHTML = "0.15(M,PK),"+p3Deposit.toFixed(3)+"(T)";
    } else if (new Date() < new Date(2035, 8, 1)) {
        p3SpanM.innerHTML = "0.25(M,SK)+0.1(M,PK),"+p3Deposit.toFixed(3)+"(T)";
        p3SpanLowM.innerHTML = "0.25(M,SK)+0.1(M,PK),"+p3Deposit.toFixed(3)+"(T)";
    } else {
        p3SpanM.innerHTML = "Graduated";
        p3SpanLowM.innerHTML = "Graduated";
    }

    var timeSpan = document.getElementById('timeSpan');
    timeSpan.innerHTML = new Date();
});
</script>  
  
</body>  
</html>