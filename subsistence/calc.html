<!DOCTYPE html>  
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<title>Document</title>  
</head>  
<body>  
  
<div id="myDiv">Subsistence Threshold: <span id="mySpan"></span></div> 
<div>
    <br/>
    Monthly Subsistence: <br/>
    RY：<span id="p1Span">0.55</span> <br/>
    RA：<span id="p2Span">0.35</span><br/>
    MK：<span id="p3Span">0.1</span><br/>
</div>
  
<script>  

function monthsBetweenDates(startDate, endDate) {  
    function dateToMonths(date) {  
        let years = date.getFullYear() - 1900;  
        let months = years * 12 + date.getMonth() + 1;  
        return months;  
    }  
    const now = new Date();   
    const startMonths = dateToMonths(startDate || now); 
    const endMonths = dateToMonths(endDate);  
  
    return endMonths - startMonths;  
} 

function calcHighSchoolDeposit() {
    const p3BeginDate = new Date(2028, 8, 1);
    let p3BeginMonths = monthsBetweenDates(null, p3BeginDate);
    const p3EndDate = new Date(2031, 7, 31);
    let p3EndMonths = monthsBetweenDates(p3BeginDate, p3EndDate);
    let p3Deposit = 0;
    if (p3BeginMonths > 0) {
        p3Deposit = 0.15 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
        p3Deposit = p3Deposit / Math.pow(1 + 0.02/12, p3BeginMonths);
        
    } else if (p3EndMonths > 0) {
        p3Deposit = 0.15 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
    }
    return p3Deposit;
}

function calcUniversityDeposit() {
    const p3BeginDate = new Date(2031, 8, 1);
    let p3BeginMonths = monthsBetweenDates(null, p3BeginDate);
    const p3EndDate = new Date(2035, 7, 31);
    let p3EndMonths = monthsBetweenDates(p3BeginDate, p3EndDate);
    let p3Deposit = 0;
    if (p3BeginMonths > 0) {
        p3Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
        p3Deposit = p3Deposit / Math.pow(1 + 0.02/12, p3BeginMonths);
        
    } else if (p3EndMonths > 0) {
        p3Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p3EndMonths) / (Math.pow(1 + 0.02/12, p3EndMonths) - 1));
    }
    return p3Deposit;
}

document.addEventListener('DOMContentLoaded', function() {  

    var span = document.getElementById('mySpan');  
      
    const p1RetireDate = new Date(2046, 5, 14);
    let p1Months = monthsBetweenDates(null, p1RetireDate);
    let p1Deposit = 0;
    if (p1Months > 0) {
        p1Deposit = 0.55 / (0.02/12 * Math.pow(1 + 0.02/12, p1Months) / (Math.pow(1 + 0.02/12, p1Months) - 1));
    }

    const p2RetireDate = new Date(2036, 12, 14);
    let p2Months = monthsBetweenDates(null, p2RetireDate);
    let p2Deposit = 0;
    if (p2Months > 0) {
        p2Deposit = 0.35 / (0.02/12 * Math.pow(1 + 0.02/12, p2Months) / (Math.pow(1 + 0.02/12, p2Months) - 1));
    }

    const p3PrimarySchoolFinishDate = new Date(2028, 7, 31);
    let p3PrimarySchoolFinishMonths = monthsBetweenDates(null, p3PrimarySchoolFinishDate);
    let p3Deposit = 0;
    if (p3PrimarySchoolFinishMonths > 0) {
        p3Deposit = 0.1 / (0.02/12 * Math.pow(1 + 0.02/12, p3PrimarySchoolFinishMonths) / (Math.pow(1 + 0.02/12, p3PrimarySchoolFinishMonths) - 1));
    }
    
    var myString = (p1Deposit + p2Deposit + p3Deposit + calcHighSchoolDeposit() + calcUniversityDeposit()).toFixed(3);

    span.innerHTML = myString; 

    var p1Span = document.getElementById('p1Span');
    var p2Span = document.getElementById('p2Span');
    var p3Span = document.getElementById('p3Span');

    if (new Date() < p1RetireDate) {
        p1Span.innerHTML = "0.55";
    } else {
        p1Span.innerHTML = "Retired"
    } 

    if (new Date() < p2RetireDate) {
        p1Span.innerHTML = "0.35";
    } else {
        p1Span.innerHTML = "Retired"
    }


    if (new Date() < new Date(2028, 8, 1)) {
        p3Span.innerHTML = "0.1(ParentKeep)";
    } else if (new Date() < new Date(2031, 8, 1)) {
        p3Span.innerHTML = "0.15(ParentKeep)";
    } else if (new Date() < new Date(2035, 8, 1)) {
        p3Span.innerHTML = "0.25(SelfKeep)+0.1(ParentKeep)";
    } else {
        p3Span.innerHTML = "Graduated"
    }
});
</script>  
  
</body>  
</html>